# Additional NGINX site configurations for PDF Converter
# This file is included by the main nginx.conf

# Future HTTPS/SSL Configuration (currently disabled)
# server {
#     listen 443 ssl http2;
#     server_name localhost;
#
#     ssl_certificate /etc/ssl/cert.pem;
#     ssl_certificate_key /etc/ssl/key.pem;
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
#     ssl_prefer_server_ciphers off;
#
#     # Same location blocks as HTTP server...
# }

# Development API Documentation Server
server {
    listen 8080;
    server_name localhost;
    
    location / {
        return 200 '
<!DOCTYPE html>
<html>
<head>
    <title>PDF Converter API Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .endpoint { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .method { color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .get { background: #28a745; }
        .post { background: #007bff; }
        .put { background: #ffc107; color: #000; }
        .delete { background: #dc3545; }
        code { background: #e9ecef; padding: 2px 4px; border-radius: 3px; }
        .service { margin: 20px 0; }
        .access-urls { background: #e8f5e9; padding: 15px; border-radius: 5px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ Enterprise PDF Converter API</h1>
        
        <div class="access-urls">
            <h3>üåê Service Access URLs</h3>
            <ul>
                <li><strong>Main API:</strong> <a href="http://localhost:7000">http://localhost:7000</a></li>
                <li><strong>MinIO Console:</strong> <a href="http://localhost:7901">http://localhost:7901</a> (minio_admin/MinioSecure2024!)</li>
                <li><strong>RabbitMQ Management:</strong> <a href="http://localhost:7673">http://localhost:7673</a> (rabbit_admin/RabbitSecure2024!)</li>
                <li><strong>Grafana Dashboard:</strong> <a href="http://localhost:7091">http://localhost:7091</a> (admin/GrafanaSecure2024!)</li>
                <li><strong>Prometheus:</strong> <a href="http://localhost:7090">http://localhost:7090</a></li>
            </ul>
        </div>

        <div class="service">
            <h3>üîê Authentication Service (Port 7002)</h3>
            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/api/v1/auth/register</code> - User registration
            </div>
            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/api/v1/auth/login</code> - User login
            </div>
            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/api/v1/auth/logout</code> - User logout
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/auth/profile</code> - Get user profile
            </div>
        </div>

        <div class="service">
            <h3>üìÅ File Service (Port 7003)</h3>
            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/api/v1/files/upload</code> - Upload file for conversion
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/files/:id</code> - Get file information
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/files/:id/download</code> - Download converted file
            </div>
            <div class="endpoint">
                <span class="method delete">DELETE</span>
                <code>/api/v1/files/:id</code> - Delete file
            </div>
        </div>

        <div class="service">
            <h3>‚öôÔ∏è Conversion Service (Port 7004)</h3>
            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/api/v1/convert/pdf</code> - Convert file to PDF
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/convert/status/:jobId</code> - Check conversion status
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/convert/history</code> - Get conversion history
            </div>
        </div>

        <div class="service">
            <h3>üîî Notification Service (Port 7005)</h3>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/notifications</code> - Get user notifications
            </div>
            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/api/v1/notifications/mark-read</code> - Mark notifications as read
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/ws/notifications</code> - WebSocket connection for real-time notifications
            </div>
        </div>

        <div class="service">
            <h3>üåê API Gateway (Port 7001)</h3>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/health</code> - System health check
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/docs</code> - API documentation
            </div>
            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/api/v1/metrics</code> - System metrics
            </div>
        </div>

        <h3>üìã Usage Examples</h3>
        <div class="endpoint">
            <p><strong>1. Register a new user:</strong></p>
            <code>curl -X POST http://localhost:7000/api/v1/auth/register -H "Content-Type: application/json" -d \'{"email":"user@example.com","password":"password123"}\'</code>
        </div>
        
        <div class="endpoint">
            <p><strong>2. Upload a file for conversion:</strong></p>
            <code>curl -X POST http://localhost:7000/api/v1/files/upload -H "Authorization: Bearer YOUR_TOKEN" -F "file=@document.docx"</code>
        </div>

        <div class="endpoint">
            <p><strong>3. Check conversion status:</strong></p>
            <code>curl -X GET http://localhost:7000/api/v1/convert/status/JOB_ID -H "Authorization: Bearer YOUR_TOKEN"</code>
        </div>

        <p><strong>Status:</strong> üü° Services starting up... Check individual service logs for status.</p>
    </div>
</body>
</html>
        ';
        add_header Content-Type text/html;
    }
}

# Health check server for load balancers
server {
    listen 9999;
    server_name localhost;
    access_log off;
    
    location /health {
        return 200 "nginx-healthy";
        add_header Content-Type text/plain;
    }
    
    location /ready {
        # Check if upstream services are ready
        proxy_pass http://api_gateway/health;
        proxy_connect_timeout 1s;
        proxy_read_timeout 1s;
    }
}